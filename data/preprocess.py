import csv
import pandas as pd
from sklearn.model_selection import train_test_split

def readcsv(fn):
    csv_reader = csv.reader(open(fn))
    data = []
    sfw = []
    for row in csv_reader:
        if row[0] not in sfw:
            sfw.append(row[0])
            data.append(row[1:])
        else:
            print(row[0])
    #return pd.DataFrame(data)
    return data

def writevoc(X):
    flattened  = [val for sublist in X for val in sublist]
    ids = list(set(flattened))
    voc = {"_GO": 0,  "_EOS": 1,  "_UNK": 2,}
    i = 3
    for id in ids:
         voc[id] = i
         i += 1
    import json
    fp2=open('voc.json','w')
    json.dump(voc, fp2)
   
def writeseq(fn, X, Y):
    with open(fn, 'w', newline = '') as f:
       writer = csv.writer(f,delimiter = ' ')
       for x,y in zip(X, Y):
            x.append(y)
            writer.writerow(x)
       f.close()

if __name__ == '__main__':
    benign = readcsv('apiseq_benign.csv')
    y1 = [0]*len(benign)
    malware = readcsv('apiseq_malware.csv')
    y2 = [1]*len(malware)
    X = benign + malware
    Y = y1 + y2
    writevoc(X)
    X_train , X_test , y_train,y_test = train_test_split(X, Y, test_size=0.3, stratify=Y)
    writeseq('train.seq',X_train, y_train)
    writeseq('valid.seq',X_test, y_test)



