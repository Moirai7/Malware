import csv
import pandas as pd
import numpy as np
def readcsv(fn):
	csv_reader = csv.reader(open(fn))
	data = []
	for row in csv_reader:
		data.append(row[2:])
	#return pd.DataFrame(data)
	return np.asarray(data)

import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt

def calfreq(datas, k):
	plt.rcParams['savefig.dpi'] = 1000
	plt.rcParams['figure.dpi'] = 1000
	plt.rcParams['font.size'] = 5
	plt.clf()
	x = np.arange(k)+1
	title = ["Adware","Backdoor","Trojan-Downloader","Trojan-Ransom","Worm","Benign"]
	for data, i, t in zip(datas,range(1,7),title):
		plt.subplot(2,3,i)
		data = [n for k in data for n in k]
		v, n = np.unique(data, return_counts=True)
		n = dict(list(reversed(sorted(dict(zip(n,v)).items())))[0:k])
		plt.bar(x, n.keys())
		plt.xticks(x, list(n.values()), fontsize=5, rotation=90)
		plt.yticks(fontsize = 5)
		for a, b in zip(x, n.keys()):
			plt.text(a, b+0.05, b, ha='center', va='bottom', fontsize=2)
		plt.title(t, fontsize=7)
	plt.tight_layout()
	plt.savefig('try.jpg', dpi=1000)       

import seaborn as sns
def callens(datas, k):
	plt.rcParams['savefig.dpi'] = 1000
	plt.rcParams['figure.dpi'] = 1000
	plt.rcParams['font.size'] = 5
	plt.clf()
	lens = [[len(d) for d in data] for data in datas]
	title = ["Adware","Backdoor","Trojan-Downloader","Trojan-Ransom","Worm","Benign"]
	colors = ['skyblue','teal','green','olive','gold','red']
	f, axes = plt.subplots(2,3)
	for l, i, t, c in zip(lens, range(1, 7), title, colors):
		axes[int((i-1)/3),int((i-1)%3)].set_title(t)
		sns.distplot(l,color=c,ax=axes[int((i-1)/3),int((i-1)%3)])
	plt.tight_layout()
	plt.savefig('try.jpg', dpi=1000)

def calstats(datas):
	lens = np.asarray([len(d) for data in datas for d in data])
	print(np.mean(lens))
	print(np.median(lens))
	print(np.max(lens))
	print(np.min(lens))

data1 = readcsv("apiseq_all_AdWare.csv")
data2 = readcsv("apiseq_all_Backdoor.csv")
data3 = readcsv("apiseq_all_Trojan-Downloader.csv")
data4 = readcsv("apiseq_all_Trojan-Ransom.csv")
data5 = readcsv("apiseq_all_Worm.csv")
data6 = readcsv("apiseq_benign_merge.csv")
#callens([data1,data2,data3,data4,data5,data6], 10)
calfreq([data1,data2,data3,data4,data5,data6], 10)
#calstats([data1,data2,data3,data4,data5,data6])
